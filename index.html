<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>í¬ì¼“ëª¬ ë„ê°</title>

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="í¬ì¼“ëª¬ ë„ê°" />
    <meta property="og:description" content="ê°„ë‹¨í•œ í¬ì¼“ëª¬ ë„ê°" />
    <meta
      property="og:image"
      content="https://github.com/c-wonjun/250929_FETCH/preview.png"
    />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />

    <!-- ì¼ë°˜ ë©”íƒ€ íƒœê·¸ -->
    <meta name="description" content="ê°„ë‹¨í•œ í¬ì¼“ëª¬ ë„ê°" />
    <link
      rel="icon"
      type="image/png"
      href="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/poke-ball.png"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: Arial, sans-serif;
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
      }
      .pokedex-container {
        background: #dc0a2d;
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        border: 8px solid #333;
      }
      .pokedex-header {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 3px solid #a00a1a;
      }
      .pokedex-lights {
        display: flex;
        gap: 10px;
        align-items: center;
      }
      .big-light {
        width: 60px;
        height: 60px;
        background: radial-gradient(circle at 30% 30%, #4dd9ff, #0088cc);
        border-radius: 50%;
        border: 4px solid #fff;
        box-shadow: 0 0 20px rgba(77, 217, 255, 0.6),
          inset -5px -5px 10px rgba(0, 0, 0, 0.3);
      }
      .small-lights {
        display: flex;
        gap: 8px;
      }
      .small-light {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        border: 2px solid #fff;
      }
      .small-light.red {
        background: radial-gradient(circle at 30% 30%, #ff6b6b, #c92a2a);
      }
      .small-light.yellow {
        background: radial-gradient(circle at 30% 30%, #ffd43b, #fab005);
      }
      .small-light.green {
        background: radial-gradient(circle at 30% 30%, #51cf66, #2f9e44);
      }
      .pokedex-title {
        flex: 1;
        text-align: center;
      }
      .pokedex-title h1 {
        color: #fff;
        font-size: 32px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        font-weight: bold;
      }
      .search-section {
        background: #f8f9fa;
        padding: 30px;
        border-radius: 15px;
        margin-bottom: 20px;
        box-shadow: inset 0 4px 8px rgba(0, 0, 0, 0.1);
      }
      .search-container {
        display: flex;
        gap: 10px;
        max-width: 400px;
        margin: 0 auto;
      }
      #pokeId {
        flex: 1;
        padding: 15px;
        font-size: 18px;
        border: 3px solid #333;
        border-radius: 10px;
        outline: none;
        background: #fff;
      }
      #pokeBtn {
        padding: 15px 30px;
        font-size: 18px;
        font-weight: bold;
        background: linear-gradient(180deg, #ffd43b 0%, #fab005 100%);
        border: 3px solid #333;
        border-radius: 10px;
        cursor: pointer;
        color: #333;
        transition: transform 0.1s;
        box-shadow: 0 4px 0 #c97a05;
      }
      #pokeBtn:hover {
        background: linear-gradient(180deg, #ffe066 0%, #fcc419 100%);
      }
      #pokeBtn:active {
        transform: translateY(2px);
        box-shadow: 0 2px 0 #c97a05;
      }
      .initial-message {
        text-align: center;
        color: #666;
        padding: 40px 20px;
        background: #fff;
        border-radius: 15px;
        box-shadow: inset 0 4px 8px rgba(0, 0, 0, 0.1);
      }
      .initial-message h2 {
        font-size: 24px;
        margin-bottom: 15px;
        color: #333;
      }
      .initial-message p {
        font-size: 16px;
        line-height: 1.6;
      }
      .pokeball-icon {
        width: 80px;
        height: 80px;
        margin: 0 auto 20px;
      }
      .type-badge {
        display: inline-block;
        padding: 5px 15px;
        margin: 5px;
        border-radius: 20px;
        color: white;
        font-weight: bold;
        text-transform: uppercase;
        font-size: 12px;
      }
      .description {
        background-color: #f8f9fa;
        padding: 15px;
        border-radius: 10px;
        margin: 15px 20px;
        line-height: 1.6;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }
      #pokeBox {
        background: #fff;
        border-radius: 15px;
        box-shadow: inset 0 4px 8px rgba(0, 0, 0, 0.1);
      }
      #pokeBox > div:not(.initial-message) {
        text-align: center;
        padding: 30px;
      }
      img {
        width: 200px;
        height: 200px;
      }
      .info-section {
        margin: 20px;
        padding: 15px;
        background-color: #f8f9fa;
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        text-align: left;
      }
      .info-section h3 {
        margin-top: 0;
        border-bottom: 2px solid #ddd;
        padding-bottom: 10px;
        color: #333;
      }
      .ability-item {
        margin: 10px 0;
        padding: 10px;
        background-color: #f8f9fa;
        border-radius: 5px;
        border-left: 3px solid #007bff;
      }
      .ability-name {
        font-weight: bold;
        color: #007bff;
      }
      .hidden-ability {
        border-left: 3px solid #ffc107;
      }
      .evolution-chain {
        display: flex;
        align-items: center;
        justify-content: center;
        flex-wrap: wrap;
        gap: 20px;
        margin: 20px 0;
      }
      .evolution-item {
        text-align: center;
      }
      .evolution-item img {
        width: 96px;
        height: 96px;
      }
      .evolution-item .evo-name {
        font-weight: bold;
        margin-top: 5px;
      }
      .evolution-arrow {
        font-size: 24px;
        color: #666;
      }
      .evolution-condition {
        font-size: 12px;
        color: #666;
        margin-top: 5px;
      }
      .moves-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
        max-height: 400px;
        overflow-y: auto;
        display: block;
      }
      .moves-table thead {
        position: sticky;
        top: 0;
        background-color: #007bff;
        color: white;
      }
      .moves-table th,
      .moves-table td {
        padding: 10px;
        text-align: left;
        border-bottom: 1px solid #ddd;
      }
      .moves-table tbody {
        display: block;
        max-height: 350px;
        overflow-y: auto;
      }
      .moves-table thead,
      .moves-table tbody tr {
        display: table;
        width: 100%;
        table-layout: fixed;
      }
      .moves-table tr:hover {
        background-color: #f5f5f5;
      }
      .nature-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 10px;
        margin-top: 10px;
      }
      .nature-item {
        padding: 8px;
        background-color: #f8f9fa;
        border-radius: 5px;
        text-align: center;
        font-size: 14px;
      }
      .loading {
        text-align: center;
        color: #666;
        padding: 20px;
      }
    </style>
  </head>
  <body>
    <div class="pokedex-container">
      <div class="pokedex-header">
        <div class="pokedex-lights">
          <div class="big-light"></div>
          <div class="small-lights">
            <div class="small-light red"></div>
            <div class="small-light yellow"></div>
            <div class="small-light green"></div>
          </div>
        </div>
        <div class="pokedex-title">
          <h1>í¬ì¼“ëª¬ ë„ê°</h1>
        </div>
      </div>

      <div class="search-section">
        <div class="search-container">
          <input
            id="pokeId"
            type="number"
            min="1"
            placeholder="í¬ì¼“ëª¬ ë²ˆí˜¸ ì…ë ¥ (1-1025)"
          />
          <button id="pokeBtn">ê²€ìƒ‰</button>
        </div>
      </div>

      <section id="pokeBox">
        <div class="initial-message">
          <img
            class="pokeball-icon"
            src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/poke-ball.png"
            alt="ëª¬ìŠ¤í„°ë³¼"
          />
          <h2>í™˜ì˜í•©ë‹ˆë‹¤!</h2>
          <p>í¬ì¼“ëª¬ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ê³  ê²€ìƒ‰ ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”.</p>
          <p>1ë²ˆë¶€í„° 1025ë²ˆê¹Œì§€ì˜ í¬ì¼“ëª¬ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        </div>
      </section>
    </div>
    <script>
      // íƒ€ì… ìƒ‰ìƒ ë§¤í•‘
      const typeColors = {
        normal: "#A8A878",
        fire: "#F08030",
        water: "#6890F0",
        electric: "#F8D030",
        grass: "#78C850",
        ice: "#98D8D8",
        fighting: "#C03028",
        poison: "#A040A0",
        ground: "#E0C068",
        flying: "#A890F0",
        psychic: "#F85888",
        bug: "#A8B820",
        rock: "#B8A038",
        ghost: "#705898",
        dragon: "#7038F8",
        dark: "#705848",
        steel: "#B8B8D0",
        fairy: "#EE99AC",
      };

      // íƒ€ì… í•œê¸€ ë²ˆì—­
      const typeKorean = {
        normal: "ë…¸ë§",
        fire: "ë¶ˆê½ƒ",
        water: "ë¬¼",
        electric: "ì „ê¸°",
        grass: "í’€",
        ice: "ì–¼ìŒ",
        fighting: "ê²©íˆ¬",
        poison: "ë…",
        ground: "ë•…",
        flying: "ë¹„í–‰",
        psychic: "ì—ìŠ¤í¼",
        bug: "ë²Œë ˆ",
        rock: "ë°”ìœ„",
        ghost: "ê³ ìŠ¤íŠ¸",
        dragon: "ë“œë˜ê³¤",
        dark: "ì•…",
        steel: "ê°•ì² ",
        fairy: "í˜ì–´ë¦¬",
      };

      // íƒ€ì… ìƒì„± ì •ë³´ ê°€ì ¸ì˜¤ê¸°
      async function getTypeEffectiveness(types) {
        const typeData = await Promise.all(
          types.map((type) =>
            fetch(`https://pokeapi.co/api/v2/type/${type}`).then((r) =>
              r.json()
            )
          )
        );

        // ëª¨ë“  íƒ€ì… ëª©ë¡
        const allTypes = Object.keys(typeColors);

        // ë°©ì–´ ì‹œ ìƒì„± ê³„ì‚°
        const defenseMultipliers = {};

        // ëª¨ë“  íƒ€ì…ì„ 1ë°°ë¡œ ì´ˆê¸°í™”
        allTypes.forEach((type) => {
          defenseMultipliers[type] = 1;
        });

        // ê° íƒ€ì…ì˜ ìƒì„± ì •ë³´ ë°˜ì˜
        types.forEach((type, index) => {
          const data = typeData[index];

          data.damage_relations.double_damage_from.forEach((t) => {
            defenseMultipliers[t.name] = (defenseMultipliers[t.name] || 1) * 2;
          });

          data.damage_relations.half_damage_from.forEach((t) => {
            defenseMultipliers[t.name] =
              (defenseMultipliers[t.name] || 1) * 0.5;
          });

          data.damage_relations.no_damage_from.forEach((t) => {
            defenseMultipliers[t.name] = 0;
          });
        });

        return {
          defenseMultipliers,
        };
      }

      // íŠ¹ì„± ì •ë³´ ê°€ì ¸ì˜¤ê¸°
      async function getAbilityInfo(abilityUrl) {
        const response = await fetch(abilityUrl);
        const data = await response.json();
        const koName =
          data.names.find((n) => n.language.name === "ko")?.name || data.name;
        const koEffect =
          data.flavor_text_entries
            .find((e) => e.language.name === "ko")
            ?.flavor_text.replace(/\n/g, " ") || "";
        return { koName, koEffect };
      }

      // ì§„í™” ì²´ì¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
      async function getEvolutionChain(evolutionChainUrl) {
        const response = await fetch(evolutionChainUrl);
        const data = await response.json();

        const chain = [];
        let current = data.chain;

        while (current) {
          const speciesId = current.species.url
            .split("/")
            .filter(Boolean)
            .pop();
          const evolutionDetails = current.evolution_details[0];

          // í¬ì¼“ëª¬ ìƒì„¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ì´ë¯¸ì§€ìš©)
          const pokemonResponse = await fetch(
            `https://pokeapi.co/api/v2/pokemon/${speciesId}`
          );
          const pokemonData = await pokemonResponse.json();

          // ì¢… ì •ë³´ ê°€ì ¸ì˜¤ê¸° (í•œê¸€ ì´ë¦„ìš©)
          const speciesResponse = await fetch(current.species.url);
          const speciesData = await speciesResponse.json();
          const koName =
            speciesData.names.find((n) => n.language.name === "ko")?.name ||
            current.species.name;

          chain.push({
            name: current.species.name,
            koName: koName,
            id: speciesId,
            sprite: pokemonData.sprites.front_default,
            trigger: evolutionDetails?.trigger?.name || null,
            minLevel: evolutionDetails?.min_level || null,
            item: evolutionDetails?.item?.name || null,
            minHappiness: evolutionDetails?.min_happiness || null,
            timeOfDay: evolutionDetails?.time_of_day || null,
            location: evolutionDetails?.location?.name || null,
          });

          current = current.evolves_to[0];
        }

        return chain;
      }

      // ê¸°ìˆ ëª… í•œê¸€ë¡œ ê°€ì ¸ì˜¤ê¸°
      async function getMoveNameKo(moveUrl) {
        const response = await fetch(moveUrl);
        const data = await response.json();
        return (
          data.names.find((n) => n.language.name === "ko")?.name || data.name
        );
      }

      // ê¸°ìˆ ëª… í•œê¸€ë¡œ ê°€ì ¸ì˜¤ê¸°
      async function getMoveNameKo(moveUrl) {
        const response = await fetch(moveUrl);
        const data = await response.json();
        return (
          data.names.find((n) => n.language.name === "ko")?.name || data.name
        );
      }

      // 1. APIì—ì„œ ë°ì´í„° í˜¸ì¶œí•˜ê¸°
      async function getPokemon(id) {
        const pokeBox = document.querySelector("#pokeBox");
        pokeBox.innerHTML = '<div class="loading">ë¡œë”© ì¤‘...</div>';

        try {
          console.log(`${id}ë²ˆ í¬ì¼“ëª¬ì„ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤`);

          // ê¸°ë³¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
          const response = await fetch(
            `https://pokeapi.co/api/v2/pokemon/${id}`
          );
          const data = await response.json();

          // ì¢… ì •ë³´ ê°€ì ¸ì˜¤ê¸°
          const response2 = await fetch(
            `https://pokeapi.co/api/v2/pokemon-species/${id}`
          );
          const data2 = await response2.json();

          // í•œê¸€ ì´ë¦„
          const koName =
            data2.names.find((v) => v.language.name === "ko")?.name ||
            data.name;

          // í•œê¸€ ì„¤ëª…
          const koDescription = data2.flavor_text_entries
            .filter((v) => v.language.name === "ko")
            .map((v) => v.flavor_text.replace(/\n/g, " ").replace(/\f/g, " "))
            .pop();

          // íƒ€ì… ì •ë³´ ì¶”ì¶œ
          const types = data.types.map((t) => t.type.name);

          // íƒ€ì… ìƒì„± ì •ë³´
          const effectiveness = await getTypeEffectiveness(types);

          // íŠ¹ì„± ì •ë³´
          const abilities = await Promise.all(
            data.abilities.map(async (a) => {
              const info = await getAbilityInfo(a.ability.url);
              return {
                ...info,
                isHidden: a.is_hidden,
              };
            })
          );

          // ì§„í™” ì²´ì¸ ì •ë³´
          const evolutionChain = await getEvolutionChain(
            data2.evolution_chain.url
          );

          const poke = {
            engName: data.name,
            koName,
            shape: data.sprites.front_default,
            sound: data.cries.latest,
            types,
            description: koDescription,
            effectiveness,
            abilities,
            evolutionChain,
          };

          renderPoke(poke);
        } catch (error) {
          pokeBox.innerHTML =
            '<div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>';
          console.error(error);
        }
      }

      // 2. input í†µí•´ ë²ˆí˜¸ ë°”ê¿”ë³´ê¸°
      const pokeBtn = document.querySelector("#pokeBtn");
      const pokeId = document.querySelector("#pokeId");
      pokeBtn.addEventListener("click", () => getPokemon(pokeId.value));

      // íƒ€ì… ë°°ì§€ ìƒì„± í•¨ìˆ˜
      function createTypeBadge(type) {
        const color = typeColors[type] || "#777";
        const koreanType = typeKorean[type] || type;
        return `<span class="type-badge" style="background-color: ${color}">${koreanType}</span>`;
      }

      // ì§„í™” ì¡°ê±´ í…ìŠ¤íŠ¸ ìƒì„±
      function getEvolutionConditionText(evo) {
        if (!evo.trigger) return "";

        let conditions = [];
        if (evo.minLevel) conditions.push(`ë ˆë²¨ ${evo.minLevel}`);
        if (evo.item) conditions.push(`${evo.item} ì‚¬ìš©`);
        if (evo.minHappiness) conditions.push(`ì¹œë°€ë„ ${evo.minHappiness}`);
        if (evo.timeOfDay)
          conditions.push(`${evo.timeOfDay === "day" ? "ë‚®" : "ë°¤"}`);
        if (evo.location) conditions.push(`${evo.location}ì—ì„œ`);

        return conditions.length > 0 ? conditions.join(", ") : evo.trigger;
      }

      // 3. ë°ì´í„° í™”ë©´ì— ê·¸ë¦¬ê¸°
      function renderPoke({
        engName,
        koName,
        shape,
        sound,
        types,
        description,
        effectiveness,
        abilities,
        evolutionChain,
      }) {
        const pokeBox = document.querySelector("#pokeBox");

        // íƒ€ì… ë°°ì§€ HTML ìƒì„±
        const typeBadges = types.map(createTypeBadge).join("");

        // ë°©ì–´ ìƒì„± íƒ€ì… ë¶„ë¥˜
        const superWeak = [];
        const weak = [];
        const normal = [];
        const resistant = [];
        const superResistant = [];
        const immune = [];

        Object.entries(effectiveness.defenseMultipliers).forEach(
          ([type, multiplier]) => {
            if (multiplier >= 4) superWeak.push(type);
            else if (multiplier === 2) weak.push(type);
            else if (multiplier === 1) normal.push(type);
            else if (multiplier === 0.5) resistant.push(type);
            else if (multiplier === 0.25) superResistant.push(type);
            else if (multiplier === 0) immune.push(type);
          }
        );

        const superWeakHTML =
          superWeak.length > 0
            ? `<div style="margin-top: 10px;"><strong>ì¹˜ëª…ì  ì•½ì  (4ë°°):</strong><br>${superWeak
                .map(createTypeBadge)
                .join("")}</div>`
            : "";

        const weakHTML =
          weak.length > 0
            ? `<div style="margin-top: 10px;"><strong>ì•½ì  (2ë°°):</strong><br>${weak
                .map(createTypeBadge)
                .join("")}</div>`
            : "";

        const normalHTML =
          normal.length > 0
            ? `<div style="margin-top: 10px;"><strong>ë³´í†µ (1ë°°):</strong><br>${normal
                .map(createTypeBadge)
                .join("")}</div>`
            : "";

        const resistantHTML =
          resistant.length > 0
            ? `<div style="margin-top: 10px;"><strong>ì €í•­ (0.5ë°°):</strong><br>${resistant
                .map(createTypeBadge)
                .join("")}</div>`
            : "";

        const superResistantHTML =
          superResistant.length > 0
            ? `<div style="margin-top: 10px;"><strong>ê°•í•œ ì €í•­ (0.25ë°°):</strong><br>${superResistant
                .map(createTypeBadge)
                .join("")}</div>`
            : "";

        const immuneHTML =
          immune.length > 0
            ? `<div style="margin-top: 10px;"><strong>ë¬´íš¨ (0ë°°):</strong><br>${immune
                .map(createTypeBadge)
                .join("")}</div>`
            : "";

        // íŠ¹ì„± HTML
        const abilitiesHTML = abilities
          .map(
            (a) => `
          <div class="ability-item ${a.isHidden ? "hidden-ability" : ""}">
            <div class="ability-name">${a.koName} ${
              a.isHidden ? "(ìˆ¨ê²¨ì§„ íŠ¹ì„±)" : ""
            }</div>
            <div>${a.koEffect}</div>
          </div>
        `
          )
          .join("");

        // ì§„í™” ì²´ì¸ HTML
        const evolutionHTML = evolutionChain
          .map((evo, index) => {
            const condition =
              index > 0
                ? `<div class="evolution-condition">${getEvolutionConditionText(
                    evo
                  )}</div>`
                : "";
            const arrow =
              index > 0 ? '<div class="evolution-arrow">â†’</div>' : "";
            return `
            ${arrow}
            <div class="evolution-item">
              <img src="${evo.sprite}" alt="${evo.koName}">
              <div class="evo-name">${evo.koName}</div>
              ${condition}
            </div>
          `;
          })
          .join("");

        pokeBox.innerHTML = `
            <div style="text-align: center; padding: 30px;">
              <h4>${koName}</h4>
              <div>${typeBadges}</div>
              <img src="${shape}">
              <audio src="${sound}" controls></audio>
              <div class="description">${description}</div>
            
              <div class="info-section">
                <h3>ğŸ¯ íŠ¹ì„±</h3>
                ${abilitiesHTML}
              </div>

              <div class="info-section">
                <h3>ğŸ”„ ì§„í™” ë‹¨ê³„</h3>
                <div class="evolution-chain">
                  ${evolutionHTML}
                </div>
              </div>
            
              <div class="info-section">
                <h3>ğŸ›¡ï¸ ë°©ì–´ ì‹œ ìƒì„±</h3>
                ${superWeakHTML}
                ${weakHTML}
                ${normalHTML}
                ${resistantHTML}
                ${superResistantHTML}
                ${immuneHTML}
              </div>
            </div>
        `;
      }
    </script>
  </body>
</html>
